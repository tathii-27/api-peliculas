$htmlContent = @'
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Medios Digitales</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f4f7f6;
        }
        /* Estilo para el botón flotante de Agregar */
        #addButton {
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        #addButton:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
        }
    </style>
</head>
<body class="min-h-screen">
    <div id="app" class="p-4 sm:p-8">
        <header class="mb-8 p-6 bg-white rounded-xl shadow-lg">
            <h1 class="text-3xl font-bold text-gray-800">Panel de Administración de Medios</h1>
            <p class="text-gray-500 mt-1">Gestione sus películas, series y cortometrajes.</p>
        </header>

        <div class="bg-white p-4 sm:p-6 rounded-xl shadow-lg">
            <h2 class="text-2xl font-semibold text-gray-700 mb-4">Listado de Medios</h2>
            
            <div id="messageBox" class="p-3 mb-4 rounded-lg hidden" role="alert"></div>

            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Serial</th>
                            <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Título</th>
                            <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tipo</th>
                            <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Género</th>
                            <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Director</th>
                            <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Estado</th>
                            <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="mediaTableBody" class="bg-white divide-y divide-gray-200">
                        </tbody>
                </table>
            </div>

            <p id="noDataMessage" class="text-center text-gray-500 mt-6 hidden">No hay medios cargados.</p>
        </div>

        <button id="addButton" class="fixed bottom-6 right-6 p-4 bg-indigo-600 hover:bg-indigo-700 text-white rounded-full text-2xl font-bold">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
        </button>

    </div>

    <div id="mediaModal" class="fixed inset-0 z-50 flex items-center justify-center p-4 hidden modal-overlay">
        <div class="bg-white w-full max-w-2xl rounded-xl shadow-2xl p-6 transform transition-all duration-300 scale-95 opacity-0">
            <h3 id="modalTitle" class="text-2xl font-bold text-gray-800 mb-4">Agregar Nuevo Medio</h3>
            
            <form id="mediaForm" class="space-y-4">
                <input type="hidden" id="formSerial">
                
                <div>
                    <label for="titulo" class="block text-sm font-medium text-gray-700">Título</label>
                    <input type="text" id="titulo" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border">
                </div>
                
                <div>
                    <label for="sinopsis" class="block text-sm font-medium text-gray-700">Sinopsis</label>
                    <textarea id="sinopsis" required rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border"></textarea>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <label for="url" class="block text-sm font-medium text-gray-700">URL del Video</label>
                        <input type="url" id="url" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border">
                    </div>
                    <div>
                        <label for="imagen" class="block text-sm font-medium text-gray-700">Nombre Archivo Imagen</label>
                        <input type="text" id="imagen" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border">
                    </div>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <label for="anio_estreno" class="block text-sm font-medium text-gray-700">Año de Estreno</label>
                        <input type="number" id="anio_estreno" required min="1888" max="2099" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border">
                    </div>
                    <div>
                        <label for="estado" class="block text-sm font-medium text-gray-700">Estado</label>
                        <select id="estado" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border bg-white">
                            <option value="Activo">Activo</option>
                            <option value="Inactivo">Inactivo</option>
                        </select>
                    </div>
                </div>

                <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
                    <div>
                        <label for="genero" class="block text-sm font-medium text-gray-700">Género</label>
                        <select id="genero" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border bg-white">
                            </select>
                    </div>
                    <div>
                        <label for="director" class="block text-sm font-medium text-gray-700">Director</label>
                        <select id="director" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border bg-white">
                            </select>
                    </div>
                    <div>
                        <label for="productora" class="block text-sm font-medium text-gray-700">Productora</label>
                        <select id="productora" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border bg-white">
                            </select>
                    </div>
                    <div>
                        <label for="tipo" class="block text-sm font-medium text-gray-700">Tipo</label>
                        <select id="tipo" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border bg-white">
                            </select>
                    </div>
                </div>
                
                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" id="closeModalButton" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300">
                        Cancelar
                    </button>
                    <button type="submit" class="px-4 py-2 text-sm font-medium text-white bg-indigo-600 rounded-lg hover:bg-indigo-700 shadow-md">
                        Guardar Medio
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <div id="confirmModal" class="fixed inset-0 z-50 flex items-center justify-center p-4 hidden modal-overlay">
        <div class="bg-white w-full max-w-sm rounded-xl shadow-2xl p-6 transform transition-all duration-300 scale-95 opacity-0">
            <h3 class="text-xl font-bold text-red-600 mb-3">Confirmar Eliminación</h3>
            <p id="confirmMessage" class="text-gray-600 mb-6">¿Está seguro que desea eliminar el medio **[SERIAL]**?</p>
            <div class="flex justify-end space-x-3">
                <button type="button" id="cancelDeleteButton" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300">
                    Cancelar
                </button>
                <button type="button" id="confirmDeleteButton" class="px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-lg hover:bg-red-700 shadow-md">
                    Eliminar
                </button>
            </div>
        </div>
    </div>


    <script>
        // Data inicial para simular la base de datos (se cargará en localStorage si no existe)
        const INITIAL_LOOKUPS_DATA = {
            "generos": [
                {"id": "g001", "nombre": "Acción", "estado": "Activo"},
                {"id": "g002", "nombre": "Ciencia Ficción", "estado": "Activo"},
                {"id": "g003", "nombre": "Drama", "estado": "Activo"},
                {"id": "g004", "nombre": "Comedia Dramática", "estado": "Activo"}
            ],
            "directores": [
                {"id": "d001", "nombre": "Peter Jackson", "estado": "Activo"},
                {"id": "d002", "nombre": "Francis Ford Coppola", "estado": "Activo"},
                {"id": "d003", "nombre": "Christopher Nolan", "estado": "Activo"},
                {"id": "d004", "nombre": "Denis Villeneuve", "estado": "Activo"},
                {"id": "d005", "nombre": "Quentin Tarantino", "estado": "Activo"}
            ],
            "productoras": [
                {"id": "p001", "nombre": "New Line Cinema", "estado": "Activo"},
                {"id": "p002", "nombre": "Paramount Pictures", "estado": "Activo"},
                {"id": "p003", "nombre": "Warner Bros", "estado": "Activo"},
                {"id": "p004", "nombre": "Miramax Films", "estado": "Activo"}
            ],
            "tipos": [
                {"id": "t001", "nombre": "Película", "estado": "Activo"},
                {"id": "t002", "nombre": "Cortometraje", "estado": "Activo"},
                {"id": "t003", "nombre": "Serie TV", "estado": "Activo"}
            ]
        };

        const INITIAL_MOVIES_DATA = [
            {
                "serial": "M001",
                "titulo": "El Señor de los Anillos: La Comunidad del Anillo",
                "sinopsis": "Un hobbit hereda un anillo mágico y emprende un viaje épico.",
                "url": "http://enlace.a.lotr1.com/video",
                "imagen": "LOTR1.jpg",
                "anio_estreno": 2001,
                "genero": "g001",
                "director": "d001",
                "productora": "p001",
                "tipo": "t001",
                "estado": "Activo",
                "fecha_creacion": "2025-10-09 11:14:00",
                "fecha_actualizacion": "2025-10-09 11:14:00"
            },
            {
                "serial": "M002",
                "titulo": "The Godfather",
                "sinopsis": "El patriarca de una dinastía del crimen debe pasar el poder a su hijo.",
                "url": "http://enlace.a.godfather.com/video",
                "imagen": "TheGodfather.jpg",
                "anio_estreno": 1972,
                "genero": "g003",
                "director": "d002",
                "productora": "p002",
                "tipo": "t001",
                "estado": "Activo",
                "fecha_creacion": "2025-10-09 11:14:00",
                "fecha_actualizacion": "2025-10-09 11:14:00"
            },
            {
                "serial": "M003",
                "titulo": "Dune",
                "sinopsis": "Un joven brillante debe viajar por el desierto para asegurar el futuro de su casa.",
                "url": "http://enlace.a.dune.com/video",
                "imagen": "Dune.jpg",
                "anio_estreno": 2021,
                "genero": "g002",
                "director": "d004",
                "productora": "p003",
                "tipo": "t001",
                "estado": "Activo",
                "fecha_creacion": "2025-10-09 11:14:00",
                "fecha_actualizacion": "2025-10-09 11:14:00"
            },
            {
                "serial": "M005",
                "titulo": "Dark",
                "sinopsis": "Una saga familiar con un giro sobrenatural que abarca varias generaciones y el tiempo.",
                "url": "http://enlace.a.dark.com/video",
                "imagen": "Dark.jpg",
                "anio_estreno": 2017,
                "genero": "g002",
                "director": "d003",
                "productora": "p003",
                "tipo": "t003",
                "estado": "Activo",
                "fecha_creacion": "2025-10-09 11:14:00",
                "fecha_actualizacion": "2025-10-09 11:14:00"
            }
        ];


        const modal = document.getElementById('mediaModal');
        const form = document.getElementById('mediaForm');
        const tableBody = document.getElementById('mediaTableBody');
        const messageBox = document.getElementById('messageBox');
        const confirmModal = document.getElementById('confirmModal');
        const modalContent = modal.querySelector('.shadow-2xl');
        const confirmContent = confirmModal.querySelector('.shadow-2xl');

        let lookups = {};
        let currentSerialToDelete = null;

        // --- Funciones de almacenamiento local (Simulación de API/DB) ---

        /** Inicializa los datos en localStorage si no existen. */
        function initializeLocalStorage() {
            try {
                if (!localStorage.getItem('lookups')) {
                    localStorage.setItem('lookups', JSON.stringify(INITIAL_LOOKUPS_DATA));
                }
                if (!localStorage.getItem('movies')) {
                    localStorage.setItem('movies', JSON.stringify(INITIAL_MOVIES_DATA));
                }
                console.log('Datos iniciales cargados en localStorage.');
            } catch (e) {
                console.error('Error al inicializar localStorage:', e);
                displayMessage('Error al acceder al almacenamiento local del navegador.', 'error');
            }
        }

        /** Obtiene los datos de lookups (data estática). */
        function getLookupsFromStorage() {
            try {
                const data = localStorage.getItem('lookups');
                return data ? JSON.parse(data) : {};
            } catch (e) {
                console.error('Error al parsear lookups de localStorage:', e);
                return {};
            }
        }

        /** Obtiene los datos de medios. */
        function getMoviesFromStorage() {
            try {
                const data = localStorage.getItem('movies');
                return data ? JSON.parse(data) : [];
            } catch (e) {
                console.error('Error al parsear movies de localStorage:', e);
                return [];
            }
        }

        /** Guarda los datos de medios. */
        function saveMoviesToStorage(movies) {
            try {
                localStorage.setItem('movies', JSON.stringify(movies));
            } catch (e) {
                console.error('Error al guardar movies en localStorage:', e);
                displayMessage('Error al guardar los datos en el navegador. Intente liberar espacio.', 'error');
            }
        }
        
        /** Genera el siguiente serial M00X. */
        function getNextSerial(movies) {
            if (movies.length === 0) return 'M001';

            const maxSerial = movies.reduce((max, movie) => {
                // Extraer el número, asumiendo el formato 'M001'
                const num = parseInt(movie.serial.replace('M', '')) || 0;
                return Math.max(max, num);
            }, 0);

            const nextNumber = maxSerial + 1;
            // CORRECCIÓN: Se usa padStart para asegurar el formato M00X
            return 'M' + String(nextNumber).padStart(3, '0');
        }

        // --- Funciones de Utilidad ---
        
        /** Muestra mensajes de error o éxito. */
        function displayMessage(message, type = 'success') {
            messageBox.textContent = message;
            messageBox.classList.remove('hidden', 'bg-red-100', 'text-red-700', 'bg-green-100', 'text-green-700');
            
            if (type === 'error') {
                messageBox.classList.add('bg-red-100', 'text-red-700');
            } else {
                messageBox.classList.add('bg-green-100', 'text-green-700');
            }
            
            // Ocultar después de 5 segundos
            setTimeout(() => {
                messageBox.classList.add('hidden');
            }, 5000);
        }

        /** Cierra el modal de forma animada. */
        function closeModal(targetModal, targetContent) {
            targetContent.classList.remove('scale-100', 'opacity-100');
            targetContent.classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                targetModal.classList.add('hidden');
            }, 300); // Espera la transición
        }

        /** Abre el modal de forma animada. */
        function openModal(targetModal, targetContent) {
            targetModal.classList.remove('hidden');
            setTimeout(() => {
                targetContent.classList.remove('scale-95', 'opacity-0');
                targetContent.classList.add('scale-100', 'opacity-100');
            }, 10); // Pequeño retraso para que la transición funcione
        }

        // --- Lógica de Lookups ---

        /** Carga todos los lookups desde localStorage. */
        function loadLookups() {
            const lookupsData = getLookupsFromStorage();
            lookups = {};
            
            // Convertir lookups en mapas para resolución rápida (lookupKey: {id: nombre})
            Object.keys(lookupsData).forEach(key => {
                lookups[key] = lookupsData[key].reduce((map, item) => {
                    map[item.id] = item.nombre;
                    return map;
                }, {});
                // Rellenar los <select>
                populateSelect(key, lookupsData[key]);
            });
            console.log('Lookups cargados para resolución de IDs.');
        }

        /** Rellena los elementos <select> del formulario. */
        function populateSelect(lookupName, data) {
            // CORRECCIÓN: Se usa substring para el caso de 'tipos' (tipos -> tipo)
            const selectElement = document.getElementById(lookupName.substring(0, lookupName.length - 1)); 
            if (selectElement) {
                // Opción por defecto
                selectElement.innerHTML = '<option value="" disabled selected>Seleccione...</option>'; 
                data.forEach(item => {
                    // Solo agregar ítems que estén "Activos"
                    if (item.estado === 'Activo') {
                        const option = document.createElement('option');
                        option.value = item.id;
                        option.textContent = item.nombre;
                        selectElement.appendChild(option);
                    }
                });
            }
        }

        /** Resuelve una ID a un nombre legible. */
        function resolveLookup(lookupKey, id) {
            // CORRECCIÓN: Se usa template literal correcto
            const pluralKey = `${lookupKey}s`; 
            if (lookups[pluralKey] && lookups[pluralKey][id]) {
                return lookups[pluralKey][id];
            }
            return id; // Devuelve la ID si no se encuentra el nombre
        }

        // --- Lógica de Medios (CRUD) ---

        /** Carga y renderiza todos los medios desde localStorage. */
        function loadMedia() {
            const media = getMoviesFromStorage();
            renderMediaTable(media);
        }

        /** Renderiza el cuerpo de la tabla. */
        function renderMediaTable(media) {
            tableBody.innerHTML = '';
            
            if (media.length === 0) {
                document.getElementById('noDataMessage').classList.remove('hidden');
                return;
            }
            document.getElementById('noDataMessage').classList.add('hidden');

            media.forEach(item => {
                const row = tableBody.insertRow();
                row.className = 'hover:bg-gray-100 transition duration-150';

                // Serial
                row.insertCell().textContent = item.serial;
                // Título
                row.insertCell().textContent = item.titulo;
                // Tipo (resuelto)
                row.insertCell().textContent = resolveLookup('tipo', item.tipo);
                // Género (resuelto)
                row.insertCell().textContent = resolveLookup('genero', item.genero);
                // Director (resuelto)
                row.insertCell().textContent = resolveLookup('director', item.director);
                
                // Estado
                const estadoCell = row.insertCell();
                const estadoText = item.estado;
                const colorClass = estadoText === 'Activo' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800';
                
                // CORRECCIÓN: Se usa template literal para el HTML del estado
                estadoCell.innerHTML = `<span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${colorClass}">
                    ${estadoText}
                </span>`;

                // Acciones
                const actionsCell = row.insertCell();
                actionsCell.className = 'space-x-2 whitespace-nowrap';
                
                // Botón Editar
                const editButton = document.createElement('button');
                editButton.textContent = 'Editar';
                editButton.className = 'text-indigo-600 hover:text-indigo-900 font-medium';
                editButton.onclick = () => openEditModal(item);
                actionsCell.appendChild(editButton);

                // Botón Eliminar
                const deleteButton = document.createElement('button');
                deleteButton.textContent = 'Eliminar';
                deleteButton.className = 'text-red-600 hover:text-red-900 font-medium';
                deleteButton.onclick = () => openConfirmModal(item);
                actionsCell.appendChild(deleteButton);
            });
            // CORRECCIÓN: Se usa template literal correcto
            console.log(`Renderizados ${media.length} medios.`);
        }

        /** Prepara el modal para agregar un nuevo medio. */
        function openAddModal() {
            document.getElementById('modalTitle').textContent = 'Agregar Nuevo Medio';
            document.getElementById('formSerial').value = '';
            form.reset();
            // Establecer valores por defecto para el estado después de resetear
            document.getElementById('estado').value = 'Activo'; 
            // Restablecer los selectores a la opción por defecto (Seleccione...)
            document.getElementById('genero').value = '';
            document.getElementById('director').value = '';
            document.getElementById('productora').value = '';
            document.getElementById('tipo').value = '';

            openModal(modal, modalContent);
        }

        /** Prepara el modal para editar un medio existente. */
        function openEditModal(media) {
            // CORRECCIÓN: Se usa template literal correcto
            document.getElementById('modalTitle').textContent = `Editar Medio: ${media.titulo}`; 
            document.getElementById('formSerial').value = media.serial;
            
            // Rellenar formulario
            document.getElementById('titulo').value = media.titulo;
            document.getElementById('sinopsis').value = media.sinopsis;
            document.getElementById('url').value = media.url || '';
            document.getElementById('imagen').value = media.imagen || '';
            document.getElementById('anio_estreno').value = media.anio_estreno;
            document.getElementById('estado').value = media.estado;
            
            // Rellenar selectores
            // CORRECCIÓN: Se asigna el valor del media.id al selector.
            document.getElementById('genero').value = media.genero;
            document.getElementById('director').value = media.director;
            document.getElementById('productora').value = media.productora;
            document.getElementById('tipo').value = media.tipo;

            openModal(modal, modalContent);
        }

        /** Maneja el envío del formulario (Crear o Editar) usando localStorage. */
        form.onsubmit = (e) => {
            e.preventDefault();
            
            const movies = getMoviesFromStorage();
            const serial = document.getElementById('formSerial').value;
            const isEditing = !!serial;
            
            // Formato de fecha para simular fecha de creación/actualización
            const now = new Date().toISOString().replace('T', ' ').substring(0, 19);

            let mediaData = {
                titulo: document.getElementById('titulo').value,
                sinopsis: document.getElementById('sinopsis').value,
                url: document.getElementById('url').value,
                imagen: document.getElementById('imagen').value,
                // Asegurarse de que el año sea un número
                anio_estreno: parseInt(document.getElementById('anio_estreno').value),
                estado: document.getElementById('estado').value,
                genero: document.getElementById('genero').value,
                director: document.getElementById('director').value,
                productora: document.getElementById('productora').value,
                tipo: document.getElementById('tipo').value,
            };

            if (isEditing) {
                const index = movies.findIndex(m => m.serial === serial);
                if (index !== -1) {
                    // Actualizar: fusionar datos existentes con los nuevos
                    movies[index] = {
                        ...movies[index],
                        ...mediaData,
                        fecha_actualizacion: now
                    };
                    saveMoviesToStorage(movies);
                    // CORRECCIÓN: Se usa template literal correcto
                    displayMessage(`Medio "${mediaData.titulo}" actualizado con éxito.`); 
                } else {
                    displayMessage('Error: Medio no encontrado para actualizar.', 'error');
                    return;
                }
            } else {
                // Crear: generar nuevo serial y fechas
                mediaData.serial = getNextSerial(movies);
                mediaData.fecha_creacion = now;
                mediaData.fecha_actualizacion = now;
                
                movies.push(mediaData);
                saveMoviesToStorage(movies);
                // CORRECCIÓN: Se usa template literal correcto
                displayMessage(`Medio "${mediaData.titulo}" creado con éxito.`); 
            }

            closeModal(modal, modalContent);
            loadMedia(); // Recargar la lista para reflejar los cambios
        };

        /** Prepara y abre el modal de confirmación de eliminación. */
        function openConfirmModal(media) {
            currentSerialToDelete = media.serial;
            // CORRECCIÓN: Se usa template literal correcto
            document.getElementById('confirmMessage').innerHTML = `¿Está seguro que desea eliminar permanentemente el medio:<br><strong class="text-indigo-600">${media.titulo} (${media.serial})</strong>?`; 
            openModal(confirmModal, confirmContent);
        }

        /** Ejecuta la eliminación del medio. */
        function deleteMedia() {
            closeModal(confirmModal, confirmContent);
            if (!currentSerialToDelete) return;

            const serialToDelete = currentSerialToDelete; // Guardar el serial para el mensaje de éxito
            let movies = getMoviesFromStorage();
            const initialLength = movies.length;
            
            // Filtrar y remover el medio
            movies = movies.filter(m => m.serial !== serialToDelete);

            if (movies.length < initialLength) {
                saveMoviesToStorage(movies);
                // CORRECCIÓN: Se usa template literal correcto
                displayMessage(`Medio con serial ${serialToDelete} eliminado con éxito.`); 
                loadMedia(); // Recargar la lista
            } else {
                // CORRECCIÓN: Se usa template literal correcto
                displayMessage(`Error: Medio con serial ${serialToDelete} no encontrado.`, 'error'); 
            }
            
            currentSerialToDelete = null;
        }

        // --- Inicialización y Event Listeners ---
        
        document.addEventListener('DOMContentLoaded', () => {
            initializeLocalStorage(); // Asegurar que los datos iniciales existan
            loadLookups(); // Cargar lookups para rellenar selectores
            loadMedia(); // Cargar y renderizar medios
            
            // Listeners para abrir/cerrar el modal de edición/creación
            document.getElementById('addButton').addEventListener('click', openAddModal);
            document.getElementById('closeModalButton').addEventListener('click', () => closeModal(modal, modalContent));
            
            // Listeners para el modal de confirmación de eliminación
            document.getElementById('cancelDeleteButton').addEventListener('click', () => closeModal(confirmModal, confirmContent));
            document.getElementById('confirmDeleteButton').addEventListener('click', deleteMedia);
            
            // Cerrar modales si se hace clic fuera
            window.addEventListener('click', (event) => {
                if (event.target === modal) {
                    closeModal(modal, modalContent);
                }
                if (event.target === confirmModal) {
                    closeModal(confirmModal, confirmContent);
                }
            });
        });

    </script>
</body>
</html>
'@

$fileName = "index.html"
$filePath = Join-Path -Path $PSScriptRoot -ChildPath $fileName

# Crear el archivo index.html en el mismo directorio donde se ejecuta el script de PowerShell
$htmlContent | Out-File -FilePath $filePath -Encoding UTF8

Write-Host "Archivo '$fileName' creado con éxito en: $filePath"
Write-Host "Puedes abrirlo en tu navegador para ver la aplicación CRUD."

